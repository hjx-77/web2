import{u as e}from"./chunk-CnUS1kyc.js";import{_ as t}from"./chunk-D7GzY7Cm.js";import{i as a,u as n,b as l,l as s,d as o}from"./chunk-BazkOqDS.js";import{K as r,r as i,V as d,P as p,ab as u,T as c,R as m,al as b,am as f,ad as g,ah as h,ai as w,u as k,ag as y,p as v,x,Z as D,Q as P,F as j,i as _}from"./chunk-BEtB-6HN.js";import{_ as T}from"./chunk-D5vRPYkK.js";import{s as R}from"./chunk-CwTCcLJF.js";import{d as C}from"./chunk-DCzA2D82.js";import{u as O,w as L}from"./chunk-BtghHq-e.js";import{r as N,a as A}from"./chunk-DsM932Ci.js";import{v as z}from"./chunk-CC7_aw_8.js";import"./chunk-lIqasEa_.js";import"./chunk-DHt_odDz.js";import"./chunk-BOsXNQYK.js";import"./chunk-BQCeX3nN.js";import"./chunk-CM4-pTv8.js";import"./chunk-Cnv84qe6.js";import"./chunk-DOSE5gDZ.js";import"./chunk-eUeygJj_.js";import"./chunk-CrBtHwfB.js";import"./chunk-CETJW2Zh.js";import"./chunk-Dljxjl4G.js";import"./chunk-DezxjiP8.js";import"./chunk-7CVvifAO.js";import"./chunk-q2W0n84r.js";const F={class:"drawer drawer-end h-0 w-0"},W={class:"drawer-content w-0 h-0 absolute"},S={class:"drawer-side"},E={key:0,class:"menu bg-base-200 min-h-full w-80 p-4"},J=r({__name:"index",setup(e,{expose:t}){const a=i(null),n=i(!1);return t({showDrawer:function(){a.value?.click(),n.value=!0},closeDrawer:function(){a.value?.click(),n.value=!1}}),(e,t)=>(p(),d("div",F,[t[1]||(t[1]=u("input",{id:"my-drawer-1",type:"checkbox",class:"drawer-toggle"},null,-1)),u("div",W,[u("label",{ref_key:"drawerTriggerRef",ref:a,for:"my-drawer-1"},null,512)]),u("div",S,[t[0]||(t[0]=u("label",{for:"my-drawer-1","aria-label":"close sidebar",class:"drawer-overlay"},null,-1)),n.value?(p(),d("div",E,[m(e.$slots,"content")])):c("",!0)])]))}}),M={class:"fieldset"},U={class:"label",required:""},q=["placeholder"],I={class:"validator-hint hidden"},V={class:"btn btn-neutral mt-4",type:"submit"},Q=r({__name:"SinglePerson",props:b({addOnePersonDrawerRef:{},addOnePerson:{type:Function}},{singlePersonData:{required:!0},singlePersonDataModifiers:{}}),emits:["update:singlePersonData"],setup(t){const{t:a}=e(),n=f(t,"singlePersonData");return(e,l)=>(p(),d("form",{class:"fieldset rounded-box w-xs p-4",onSubmit:l[2]||(l[2]=e=>t.addOnePerson(t.addOnePersonDrawerRef,e))},[u("fieldset",M,[u("label",U,[h(w(k(a)("table.name")),1),l[3]||(l[3]=u("span",{class:"text-red-500"},"*",-1))]),g(u("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>n.value.name=e),type:"text",class:"input validator",placeholder:k(a)("table.name"),required:"",minlength:"1"},null,8,q),[[y,n.value.name]]),u("p",I,w(k(a)("error.personNameEmpty")),1)]),u("button",V,w(k(a)("button.confirm")),1),u("button",{class:"btn btn-ghost mt-1",type:"reset",onClick:l[1]||(l[1]=e=>t.addOnePersonDrawerRef.closeDrawer())},w(k(a)("button.cancel")),1)],32))}});function Z(e){return new Worker("/web2/assets/importExcel.worker-DX4oRZDn.js",{name:e?.name})}function $({exportInputFileRef:t}){const{t:o}=e(),r=C.useToast(),d=new Z,p=x(s),u=n().personConfig,{getAllPersonList:c,getAlreadyPersonList:m}=R(u),b=(f={handleDeletePerson:function(e){u.deletePerson(e)}},[{label:a.global.t("data.name"),props:"name"},{label:a.global.t("data.isWin"),props:"isWin",formatValue:e=>e.isWin?a.global.t("data.yes"):a.global.t("data.no")},{label:a.global.t("data.operation"),actions:[{label:a.global.t("data.delete"),type:"btn-error",onClick:e=>{f.handleDeletePerson(e)}}]}]);var f;const g=i(!1),h=i({name:""});async function w(){if("zhCn"===a.global.locale.value){return await A("人口登记表-zhCn.xlsx")}return await A("personListTemplate-en.xlsx")}async function k(e){var t;p?.show(),w(),t={type:"start",data:e,templateData:await w()},d&&d.postMessage(t)}return{resetData:function(){u.resetAlreadyPerson()},deleteAll:function(){u.deleteAllPerson()},handleFileChange:async function(e){d&&(d.onmessage=e=>{if("done"===e.data.type&&(u.resetPerson(),u.addNotPersonList(e.data.data),r.open({message:o("error.importSuccess"),type:"success",position:"top-right"}),t.value&&(t.value.value="")),"error"===e.data.type){if("not right template"===e.data.message)return void r.open({message:o("error.excelFileError"),type:"error",position:"top-right"});r.open({message:e.data.message||o("error.importFail"),type:"error",position:"top-right"})}p?.hide()}),k(await N(e.target.files[0]))},exportData:function(){let e=JSON.parse(JSON.stringify(c.value));for(let n=0;n<e.length;n++)delete e[n].x,delete e[n].y,delete e[n].id,delete e[n].uuid,delete e[n].createTime,delete e[n].updateTime,delete e[n].prizeId,e[n].isWin?e[n].isWin=a.global.t("data.yes"):e[n].isWin=a.global.t("data.no"),e[n].prizeTime=e[n].prizeTime.join(","),e[n].prizeName=e[n].prizeName.join(",");let t=JSON.stringify(e);if(t=t.replaceAll(/isWin/g,a.global.t("data.isWin")).replaceAll(/name/g,a.global.t("data.name")).replaceAll(/prizeName/g,a.global.t("data.prizeName")).replaceAll(/prizeTime/g,a.global.t("data.prizeTime")),e=JSON.parse(t),e.length>0){const t=O.json_to_sheet(e),a=O.book_new();O.book_append_sheet(a,t,"Sheet1"),L(a,"data.xlsx")}},alreadyPersonList:m,allPersonList:c,tableColumnList:b,addOnePerson:function(e,t){t.preventDefault();const a=l([v(h.value)]);a[0].id=z(),u.addOnePerson(a),e.closeDrawer(),h.value={}},addPersonModalVisible:g,singlePersonData:h,downloadTemplate:function(){const e=a.global.t("data.xlsxName");fetch(`${e}`).then(e=>e.blob()).then(t=>{const a=window.URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=e,n.click(),r.open({message:o("error.downloadSuccess"),type:"success",position:"top-right"})})}}}const G={class:"min-w-1000px"},K={class:"flex gap-3"},X=["data-tip"],B={class:""},H={for:"explore"},Y=["data-tip"],ee={class:"btn btn-primary btn-sm"},te=r({__name:"index",setup(a){const n=i(),l=i(),s=i(),r=i(),{resetData:c,deleteAll:m,handleFileChange:b,exportData:f,addOnePerson:g,singlePersonData:h,alreadyPersonList:y,allPersonList:v,tableColumnList:x,downloadTemplate:R}=$({exportInputFileRef:s}),{t:C}=e();return(e,a)=>(p(),d(j,null,[D(o,{ref_key:"resetDataDialogRef",ref:n,title:k(C)("dialog.titleTip"),desc:k(C)("dialog.dialogResetWinner"),"submit-func":k(c)},null,8,["title","desc","submit-func"]),D(o,{ref_key:"delAllDataDialogRef",ref:l,title:k(C)("dialog.titleTip"),desc:k(C)("dialog.dialogDelAllPerson"),"submit-func":k(m)},null,8,["title","desc","submit-func"]),D(J,{ref_key:"addOnePersonDrawerRef",ref:r},{content:P(()=>[D(Q,{"single-person-data":k(h),"onUpdate:singlePersonData":a[0]||(a[0]=e=>_(h)?h.value=e:null),"add-one-person-drawer-ref":r.value,"add-one-person":k(g)},null,8,["single-person-data","add-one-person-drawer-ref","add-one-person"])]),_:1},512),u("div",G,[D(T,{title:k(C)("viewTitle.personManagement")},{buttons:P(()=>[u("div",K,[u("button",{class:"btn btn-error btn-sm",onClick:a[1]||(a[1]=e=>l.value.showDialog())},w(k(C)("button.allDelete")),1),u("div",{class:"tooltip tooltip-bottom","data-tip":k(C)("tooltip.downloadTemplateTip")},[u("button",{class:"no-underline btn btn-secondary btn-sm",onClick:a[2]||(a[2]=(...e)=>k(R)&&k(R)(...e))},w(k(C)("button.downloadTemplate")),1)],8,X),u("div",B,[u("label",H,[u("div",{class:"tooltip tooltip-bottom","data-tip":k(C)("tooltip.uploadExcelTip")},[u("input",{id:"explore",ref_key:"exportInputFileRef",ref:s,type:"file",class:"",style:{display:"none"},accept:".xlsx,.xls",onChange:a[3]||(a[3]=(...e)=>k(b)&&k(b)(...e))},null,544),u("span",ee,w(k(C)("button.importData")),1)],8,Y)])]),u("button",{class:"btn btn-error btn-sm",onClick:a[4]||(a[4]=e=>n.value.showDialog())},w(k(C)("button.resetData")),1),u("button",{class:"btn btn-accent btn-sm",onClick:a[5]||(a[5]=(...e)=>k(f)&&k(f)(...e))},w(k(C)("button.exportResult")),1),u("button",{class:"btn btn-neutral btn-sm",onClick:a[6]||(a[6]=e=>r.value.showDrawer())},w(k(C)("button.add")),1),u("div",null,[u("span",null,w(k(C)("table.luckyPeopleNumber"))+":",1),u("span",null,w(k(y).length),1),a[7]||(a[7]=u("span",null," / ",-1)),u("span",null,w(k(v).length),1)])])]),_:1},8,["title"]),D(t,{"table-columns":k(x),data:k(v)},null,8,["table-columns","data"])])],64))}});export{te as default};
