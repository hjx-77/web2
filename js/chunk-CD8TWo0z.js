import{l as e}from"./chunk-CrBtHwfB.js";import{s as t}from"./chunk-CwTCcLJF.js";import{u as s}from"./chunk-CnUS1kyc.js";import{_ as a}from"./chunk-D5vRPYkK.js";import{u as i,d as l}from"./chunk-D8B2djdX.js";import{K as n,r as o,am as u,c as r,w as c,O as p,P as m,Q as d,u as b,ab as v,T as f,ad as k,ag as h,V as g,Z as j,F as y,W as x,ai as C}from"./chunk-BEtB-6HN.js";import{d as w}from"./chunk-DCzA2D82.js";import{_ as M}from"./chunk-CF4e9rG_.js";import{v as _}from"./chunk-CC7_aw_8.js";import"./chunk-lIqasEa_.js";import"./chunk-DHt_odDz.js";import"./chunk-BOsXNQYK.js";import"./chunk-BQCeX3nN.js";import"./chunk-CM4-pTv8.js";import"./chunk-Cnv84qe6.js";import"./chunk-DOSE5gDZ.js";import"./chunk-eUeygJj_.js";import"./chunk-CETJW2Zh.js";import"./chunk-Dljxjl4G.js";import"./chunk-DezxjiP8.js";import"./chunk-7CVvifAO.js";import"./chunk-q2W0n84r.js";import"./chunk-DsM932Ci.js";const N={class:"flex flex-col items-center gap-6 w-full px-12"},F=["disabled"],U=n({__name:"UploadDialog",props:{visible:{type:Boolean,required:!0},visibleModifiers:{}},emits:["update:visible"],setup(t){const{t:a}=s(),n=w.useToast(),g=o("audio/*"),j=u(t,"visible"),y=i().globalConfig,x=e.createInstance({name:"audioStore"}),C=o(null),U=r({get:()=>C.value?.fileName||null,set(e){C.value&&e&&(C.value.fileName=e)}}),D=o();async function I(e){if(!e)return void(C.value=null);/audio*/.test(e?.type||"")?C.value=e:n.open({message:a("error.notAudioFile"),type:"error",position:"top-right"})}function L(){if(C.value){const{data:e,fileName:t}=C.value,s=_();x.setItem(s,{data:e,fileName:t}).then(()=>{n.open({message:a("error.uploadSuccess"),type:"success",position:"top-right"}),async function(){(await x.keys()).length>0&&x.iterate((e,t)=>{y.addMusic({id:t,name:e.fileName,url:"Storage"})})}()}).catch(()=>{n.open({message:a("error.uploadFail"),type:"error",position:"top-right"})})}}return c(j,e=>{e&&D.value.showDialog()}),(e,t)=>(m(),p(l,{ref_key:"uploadDialogRef",ref:D,visible:j.value,"onUpdate:visible":t[1]||(t[1]=e=>j.value=e),title:b(a)("dialog.uploadAudioTitle"),"submit-func":L,class:""},{content:d(()=>[v("div",N,[j.value?(m(),p(M,{key:0,"limit-type":g.value,onUploadFile:I},null,8,["limit-type"])):f("",!0),k(v("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>U.value=e),disabled:null===C.value,type:"text",class:"input w-full"},null,8,F),[[h,U.value]])])]),_:1},8,["visible","title"]))}}),D={class:"flex gap-3"},I={for:"explore"},L={class:"p-0"},S=["title"],T={class:"link hover:text-primary"},q={class:"flex gap-3"},A=["onClick"],P=["onClick"],Q=n({__name:"index",setup(l){const{t:n}=s(),u=e.createInstance({name:"audioStore"}),r=i().globalConfig,{getMusicList:c}=t(r),p=o(c),f=o(!1);function k(){r.resetMusicList(),u.clear()}function h(){r.clearMusicList(),u.clear()}return(e,t)=>(m(),g(y,null,[j(U,{visible:f.value,"onUpdate:visible":t[0]||(t[0]=e=>f.value=e)},null,8,["visible"]),v("div",null,[j(a,{title:b(n)("sidebar.musicManagement")},{buttons:d(()=>[v("div",D,[v("button",{class:"btn btn-primary btn-sm",onClick:k},C(b(n)("button.reset")),1),v("label",I,[v("span",{class:"btn btn-primary btn-sm",onClick:t[1]||(t[1]=e=>f.value=!0)},C(b(n)("button.upload")),1)]),v("button",{class:"btn btn-error btn-sm",onClick:h},C(b(n)("button.allDelete")),1)])]),_:1},8,["title"]),v("div",null,[v("ul",L,[(m(!0),g(y,null,x(p.value,e=>(m(),g("li",{key:e.id,class:"flex items-center gap-6 pb-2 mb-3"},[v("div",{class:"mr-12 overflow-hidden w-72 whitespace-nowrap text-ellipsis",title:e.name},[v("a",T,C(e.name),1)],8,S),v("div",q,[v("button",{class:"btn btn-primary btn-xs",onClick:t=>async function(e){r.setCurrentMusic(e,!1)}(e)},C(b(n)("button.play")),9,A),v("button",{class:"btn btn-error btn-xs",onClick:t=>function(e){r.removeMusic(e.id),u.removeItem(e.name)}(e)},C(b(n)("button.delete")),9,P)])]))),128))])])])],64))}});export{Q as default};
