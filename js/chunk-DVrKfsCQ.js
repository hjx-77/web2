import{r as e,e as t,w as l,K as s,V as a,P as n,Z as o,Q as u,u as i,i as c,ab as r,ai as d,F as p,W as m,ac as b,T as f,ad as h,ag as x,ao as k,S as g}from"./chunk-BEtB-6HN.js";import{l as v}from"./chunk-XSW0eSR2.js";import{u as w}from"./chunk-CnUS1kyc.js";import{u as C,i as j,e as y}from"./chunk-Bjj3R50d.js";import{_ as z}from"./chunk-D5vRPYkK.js";import{l as P}from"./chunk-CrBtHwfB.js";import{s as U}from"./chunk-CwTCcLJF.js";import{d as L}from"./chunk-DCzA2D82.js";import{c as D}from"./chunk-BY3IMhEk.js";import{G as V}from"./chunk-eUeygJj_.js";import"./chunk-lIqasEa_.js";import"./chunk-DHt_odDz.js";import"./chunk-BOsXNQYK.js";import"./chunk-BQCeX3nN.js";import"./chunk-CM4-pTv8.js";import"./chunk-Cnv84qe6.js";import"./chunk-DOSE5gDZ.js";import"./chunk-CETJW2Zh.js";import"./chunk-Dljxjl4G.js";import"./chunk-CC7_aw_8.js";import"./chunk-DezxjiP8.js";import"./chunk-7CVvifAO.js";import"./chunk-q2W0n84r.js";function S(){const s=L.useToast(),a=P.createInstance({name:"imgStore"}),n=C().prizeConfig,o=C().globalConfig,{getPrizeConfig:u,getCurrentPrize:i}=U(n),{getImageList:c}=U(o),r=e([]),d=e(D(u.value)),p=e();return t(()=>{!async function(){(await a.keys()).length>0&&a.iterate((e,t)=>{r.value.push({key:t,value:e})})}()}),l(()=>d.value,e=>{n.setPrizeConfig(e)},{deep:!0}),{addPrize:function(){const e={id:(new Date).getTime().toString(),name:j.global.t("data.prizeName"),sort:0,isAll:!1,count:1,isUsedCount:0,picture:{id:"",name:"",url:""},separateCount:{enable:!1,countList:[]},desc:"",isUsed:!1,isShow:!0,frequency:1};d.value.push(e),s.success(j.global.t("error.success"))},resetDefault:function(){n.resetDefault(),d.value=D(u.value),s.success(j.global.t("error.success"))},delAll:async function(){d.value=[],s.success(j.global.t("error.success"))},delItem:function(e){n.deletePrizeConfig(e.id),s.success(j.global.t("error.deleteSuccess"))},prizeList:d,currentPrize:i,selectedPrize:p,submitData:function(e){p.value.separateCount.countList=e,p.value=null},changePrizePerson:function(e){let t=-1;for(let l=0;l<d.value.length;l++)if(d.value[l].id===e.id){t=l;break}t>-1&&(d.value[t].separateCount.countList=[],d.value[t].isUsed?d.value[t].isUsedCount=d.value[t].count:d.value[t].isUsedCount=0)},changePrizeStatus:function(e){e.isUsed?e.isUsedCount=0:e.isUsedCount=e.count,e.separateCount.countList=[],e.isUsed=!e.isUsed},selectPrize:function(e){p.value=e,p.value.isUsedCount=0,p.value.isUsed=!1,p.value.separateCount.countList.length>1||(p.value.separateCount={enable:!0,countList:[{id:"0",count:e.count,isUsedCount:0}]})},localImageList:c}}const A={class:"flex w-full gap-3"},I={role:"alert",class:"w-full my-4 alert alert-info"},$={class:"flex items-center justify-center max-w-xs px-2 handle form-control"},_={class:"w-1/2 max-w-xs form-control"},M={class:"label"},N={class:"label-text"},T=["onUpdate:modelValue","placeholder"],q={class:"flex items-center w-1/2 max-w-xs gap-2 form-control"},F={class:"label"},G={class:"label-text"},H=["checked","onChange"],Q={class:"w-1/2 max-w-xs form-control"},R={class:"label"},B={class:"label-text"},J=["onUpdate:modelValue","placeholder","onChange"],K=["data-tip"],O=["value","max"],W={class:"flex items-center w-1/2 max-w-xs gap-2 form-control"},Z={class:"label"},E={class:"label-text"},X=["checked","onChange"],Y={class:"w-full max-w-xs form-control"},ee={class:"label"},te={class:"label-text"},le=["onUpdate:modelValue"],se={key:0,value:{id:"",name:"",url:""}},ae={disabled:"",selected:""},ne=["title","value"],oe={class:"truncate w-option-xs"},ue={key:0,class:"w-full max-w-xs form-control"},ie={class:"label"},ce={class:"label-text"},re=["onClick"],de={key:0,class:"flex flex-wrap w-full h-full gap-1 p-0 pt-1 m-0 cursor-pointer"},pe=["data-tip"],me={key:1,class:"btn btn-secondary btn-xs"},be={class:"w-full max-w-xs form-control"},fe={class:"label"},he={class:"label-text"},xe={class:"flex gap-2"},ke=["onClick"],ge=s({__name:"PrizeConfig",setup(e){const{addPrize:t,resetDefault:l,delAll:s,delItem:C,prizeList:j,currentPrize:P,selectedPrize:U,submitData:L,changePrizePerson:D,changePrizeStatus:ge,selectPrize:ve,localImageList:we}=S(),{t:Ce}=w();return(e,w)=>(n(),a("div",null,[o(z,{title:i(Ce)("viewTitle.prizeManagement")},{buttons:u(()=>[r("div",A,[r("button",{class:"btn btn-info btn-sm",onClick:w[0]||(w[0]=(...e)=>i(t)&&i(t)(...e))},d(i(Ce)("button.add")),1),r("button",{class:"btn btn-info btn-sm",onClick:w[1]||(w[1]=(...e)=>i(l)&&i(l)(...e))},d(i(Ce)("button.resetDefault")),1),r("button",{class:"btn btn-error btn-sm",onClick:w[2]||(w[2]=(...e)=>i(s)&&i(s)(...e))},d(i(Ce)("button.allDelete")),1)])]),alerts:u(()=>[r("div",I,[w[4]||(w[4]=r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"w-6 h-6 stroke-current shrink-0"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),r("span",null,d(i(Ce)("dialog.tipResetPrize")),1)])]),_:1},8,["title"]),o(i(v),{modelValue:i(j),"onUpdate:modelValue":w[3]||(w[3]=e=>c(j)?j.value=e:null),animation:150,handle:".handle",class:"p-0 m-0"},{default:u(()=>[(n(!0),a(p,null,m(i(j),e=>(n(),a("div",{key:e.id,class:b(["flex items-center justify-center gap-10 py-5",i(P).id===e.id?"border border-dotted rounded-xl":null])},[r("label",$,[o(i(V),{class:"w-10 h-10 cursor-move handle"})]),r("label",_,[r("div",M,[r("span",N,d(i(Ce)("table.prizeName")),1)]),h(r("input",{"onUpdate:modelValue":t=>e.name=t,type:"text",placeholder:i(Ce)("placeHolder.name"),class:"w-full max-w-xs input-sm input input-bordered"},null,8,T),[[x,e.name]])]),r("label",q,[r("div",F,[r("span",G,d(i(Ce)("table.fullParticipation")),1)]),r("input",{type:"checkbox",checked:e.isAll,class:"border-solid checkbox checkbox-secondary border",onChange:t=>e.isAll=!e.isAll},null,40,H)]),r("label",Q,[r("div",R,[r("span",B,d(i(Ce)("table.numberParticipants")),1)]),h(r("input",{"onUpdate:modelValue":t=>e.count=t,type:"number",placeholder:i(Ce)("placeHolder.winnerCount"),class:"w-full max-w-xs p-0 m-0 input-sm input input-bordered",onChange:t=>i(D)(e)},null,40,J),[[x,e.count]]),r("div",{class:"tooltip tooltip-bottom","data-tip":`${i(Ce)("table.isDone")+e.isUsedCount}/${e.count}`},[r("progress",{class:"w-full progress",value:e.isUsedCount,max:e.count},null,8,O)],8,K)]),r("label",W,[r("div",Z,[r("span",E,d(i(Ce)("table.isDone")),1)]),r("input",{type:"checkbox",checked:e.isUsed,class:"border-solid checkbox checkbox-secondary border",onChange:t=>i(ge)(e)},null,40,X)]),r("label",Y,[r("div",ee,[r("span",te,d(i(Ce)("table.image")),1)]),h(r("select",{"onUpdate:modelValue":t=>e.picture=t,class:"truncate select select-warning select-sm"},[e.picture.id?(n(),a("option",se,"âŒ")):f("",!0),r("option",ae,d(i(Ce)("table.selectPicture")),1),(n(!0),a(p,null,m(i(we),e=>(n(),a("option",{key:e.id,title:e.name,class:"w-full max-w-full",value:e},[r("span",oe,d(e.name),1)],8,ne))),128))],8,le),[[k,e.picture]])]),e.separateCount?(n(),a("label",ue,[r("div",ie,[r("span",ce,d(i(Ce)("table.onceNumber")),1)]),r("div",{class:"flex justify-start w-full h-full",onClick:t=>i(ve)(e)},[e.separateCount.countList.length?(n(),a("ul",de,[(n(!0),a(p,null,m(e.separateCount.countList,e=>(n(),a("li",{key:e.id,class:"relative flex items-center justify-center w-8 h-8 bg-slate-600/60 separated"},[r("div",{class:"flex items-center justify-center w-full h-full tooltip","data-tip":`${i(Ce)("tooltip.doneCount")+e.isUsedCount}/${e.count}`},[r("div",{class:"absolute left-0 z-50 h-full bg-blue-300/80",style:g(`width:${100*e.isUsedCount/e.count}%`)},null,4),r("span",null,d(e.count),1)],8,pe)]))),128))])):(n(),a("button",me,d(i(Ce)("button.setting")),1))],8,re)])):f("",!0),r("label",be,[r("div",fe,[r("span",he,d(i(Ce)("table.operation")),1)]),r("div",xe,[r("button",{class:"btn btn-error btn-xs",onClick:t=>i(C)(e)},d(i(Ce)("button.delete")),9,ke)])])],2))),128))]),_:1},8,["modelValue"]),o(y,{"total-number":i(U)?.count,"separated-number":i(U)?.separateCount.countList,onSubmitData:i(L)},null,8,["total-number","separated-number","onSubmitData"])]))}});export{ge as default};
